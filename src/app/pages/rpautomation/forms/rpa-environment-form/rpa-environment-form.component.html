<div id="createenvironment" class="rpa-modal">
    <div class="rpa-modal-content">
        <div class="rpa-modal-header">
            <span class="rpa-modal-close" (click)="closeOverlay()"><img
                    src="../../../../assets/images/RPA/icon_latest/close.svg" alt=""></span>
            <h4 *ngIf="isCreate">Create Environment</h4>
            <h4 *ngIf="!isCreate">Modify Environment</h4>
        </div>
        <div class="modal-body">
            <div class="container m-contanier form-body">
                <form [formGroup]="environmentForm" (ngSubmit)="submitEnvironmentForm()">
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="environmentName">Name<span class="star">*</span></label>
                        <input type="text" maxlength="51" class="form-control data" formControlName="environmentName"
                            #environmentName value="" placeholder="Enter Name">
                        <span
                            *ngIf="(environmentForm.get('environmentName').invalid && environmentForm.get('environmentName').touched) && !environmentForm.controls['environmentName'].hasError('maxlength')"
                            class="errspan required">Name Required*</span>
                        <div *ngIf="environmentForm.controls['environmentName'].hasError('maxlength')"
                            class="errspan required">
                            Maximum of 50 characters
                        </div>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="environmentType">Type<span class="star">*</span></label>
                        <select class="form-control" formControlName="environmentType" (change)="onChangeEnvType()">
                            <option value="" [selected]="true">Select Type</option>
                            <option value="Windows">Windows</option>
                            <option value="Mac">Mac</option>
                            <option value="Linux">Linux</option>

                        </select>
                        <span
                            *ngIf="environmentForm.get('environmentType').invalid && environmentForm.get('environmentType').touched"
                            class="errspan required">Type Required*</span>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="agentPath">Agent Path<span class="star">*</span></label>
                        <input type="text" maxlength="51" class="form-control" formControlName="agentPath" value=""
                            placeholder="Enter Agent Path">
                        <span
                            *ngIf="(environmentForm.get('agentPath').invalid && environmentForm.get('agentPath').touched) && !environmentForm.controls['agentPath'].hasError('maxlength')"
                            class="errspan required"> Agent Path Required*</span>

                        <div *ngIf="environmentForm.controls['agentPath'].hasError('maxlength')"
                            class="errspan required">
                            Maximum of 50 characters
                        </div>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="hostAddress"> IP Address / Host<span
                                class="star">*</span></label>
                        <input type="text" maxlength="51" class="form-control" formControlName="hostAddress" value=""
                            placeholder="Enter IP Address / Host">
                        <span
                            *ngIf="(environmentForm.get('hostAddress').invalid && environmentForm.get('hostAddress').touched) && !environmentForm.controls['hostAddress'].hasError('maxlength') && !environmentForm.controls['hostAddress'].hasError('pattern')"
                            class="errspan required"> IP Address/Host Required*</span>
                        <div *ngIf="(environmentForm.controls['hostAddress'].hasError('pattern') && !environmentForm.controls['hostAddress'].hasError('maxlength')) && environmentForm.get('hostAddress').touched"
                            class="errspan required">
                            Invalid IP Address format
                        </div>
                        <div *ngIf="(environmentForm.controls['hostAddress'].hasError('pattern') && environmentForm.controls['hostAddress'].hasError('maxlength'))"
                            class="errspan required">
                            Invalid IP Address format
                        </div>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="categoryId">Category<span class="star">*</span></label>
                        <select type="text" class="form-control" formControlName="categoryId"
                            [value]="categoriesList.length==1?categoriesList[0].categoryId:'0'">
                            <option value="0" disabled>Select Category</option>
                            <option [value]="category.categoryId" *ngFor="let category of categoriesList">
                                {{category.categoryName}}</option>
                        </select>
                        <span
                            *ngIf="(environmentForm.get('categoryId').invalid && environmentForm.get('categoryId').touched)"
                            class="errspan required"> Category Required*</span>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="userName">Username<span class="star">*</span></label>
                        <input type="text" maxlength="51" class="form-control" formControlName="username" value=""
                            placeholder="Enter Username">
                        <span
                            *ngIf="(environmentForm.get('username').invalid && environmentForm.get('username').touched) && !environmentForm.controls['username'].hasError('maxlength')"
                            class="errspan required"> Username Required*</span>
                        <div *ngIf="environmentForm.controls['username'].hasError('maxlength')"
                            class="errspan required">
                            Maximum of 50 characters
                        </div>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="password"><input type="checkbox" [checked]="isKeyValuePair"
                                (change)="keypair($event)">Key Pair Authentication<span class="star">*</span> </label>
                    </div>
                    <div class="col-md-12 p-0 form-group" *ngIf="isKeyValuePair==false">
                        <label class="label-control" for="password">Password<span class="star">*</span></label>
                        <input [type]="passwordtype1 ? 'text': 'password'" class="form-control" [(ngModel)]="password"
                            [ngModelOptions]="{standalone: true}" placeholder="Enter Password">
                        <span *ngIf="passwordtype1==false" (click)="passwordtype1 =!passwordtype1" class="pdicon">
                            <img src="../../../../../assets/images/Projects/eye-show.svg" class="testplus1">
                        </span>
                        <span *ngIf="passwordtype1==true" (click)="passwordtype1 =!passwordtype1" class="pdicon">
                            <img src="../../../../../assets/images/Projects/eye-hide.svg" class="testplus1">
                        </span>
                    </div>
                    <div class="col-md-12 p-0 form-group" *ngIf="isKeyValuePair==true">
                        <!-- <label class="label-control" for="KeyValuePair">Key Value Pair <span class="star">*</span></label> -->
                        <input type="file" (change)="keyValueFile=$event.target.files[0]" class="form-control"
                            id="KeyValuePair">
                        <a class="downloadLink" *ngIf="updateenvdata.keyValue !=null"
                            (click)="downloadKey(updateenvdata.environmentName,updateenvdata.keyValue)">Download Key</a>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="connectionType">Connection Type<span
                                class="star">*</span></label>
                        <input type="text" maxlength="51" class="form-control" formControlName="connectionType" value=""
                            placeholder="Enter Connection Type" readonly>
                        <span
                            *ngIf="(environmentForm.get('connectionType').invalid && environmentForm.get('connectionType').touched) && !environmentForm.controls['connectionType'].hasError('maxlength')"
                            class="errspan required"> Connection Type Required*</span>
                        <div *ngIf="environmentForm.controls['connectionType'].hasError('maxlength')"
                            class="errspan required">
                            Maximum of 50 characters
                        </div>
                    </div>
                    <div class="col-md-12 p-0 form-group">
                        <label class="label-control" for="portNumber">Port<span class="star">*</span></label>
                        <input type="number" maxlength="5" onkeypress="if(this.value.length==4) return false"
                            class="form-control" (keypress)="onlyNumbersAllowed($event)" formControlName="portNumber"
                            value="" placeholder="Enter Port">
                        <span
                            *ngIf="(environmentForm.get('portNumber').invalid && environmentForm.get('portNumber').touched) && !environmentForm.controls['portNumber'].hasError('maxlength')"
                            class="errspan required"> Port Required*</span>
                        <div *ngIf="environmentForm.controls['portNumber'].hasError('maxlength')"
                            class="errspan required">
                            Maximum of 4 characters
                        </div>
                    </div>
                    <div class="col-md-6 p-0 form-group">
                        <input type="checkbox" formControlName="activeStatus"> Active
                    </div>
                </form>
                <div class="form-footer">
                    <button class="btn btn-default" (click)="resetEnvForm()">Reset</button>
                    <button class="btn btn-primary btn-test"
                        [disabled]="environmentForm.invalid || !((password!='' && isKeyValuePair==false  )||(isKeyValuePair==true && keyValueFile!=undefined))"
                        (click)="testConnection()">Test Connection</button>
                    <button class="btn btn-primary"
                        [disabled]=" environmentForm.invalid || !((password!='' && isKeyValuePair==false  )||(isKeyValuePair==true && keyValueFile!=undefined))"
                        (click)="submitEnvironmentForm()">
                        <span *ngIf="isCreate">Save</span>
                        <span *ngIf="!isCreate">Update</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>