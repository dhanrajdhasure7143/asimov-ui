<div class="bg-color">
<br>
<br>
<div class="container-fluid">
<div class="form-inline">

  <div class="form-group">
    <span style="padding:5px">
      <mat-form-field>
        <mat-label>Select Category</mat-label>
          <mat-select [(ngModel)]="selectedcategory" (selectionChange)="applyFilter1()">
            <mat-option *ngFor="let category of categaoriesList" [value]="category.categoryId">{{category.categoryName}}
            </mat-option>
          </mat-select>
      </mat-form-field>
    </span>
      <span style="padding:5px">
        <mat-form-field *ngIf="process_names!=undefined">
            <mat-label>Select Process</mat-label>
            <mat-select [(ngModel)]="selectedvalue" (selectionChange)="applyFilter($event.value)">
                <mat-option *ngFor="let process of selected_process_names" [value]="process.processId">{{process.processName}}
                </mat-option>
            </mat-select>
        </mat-form-field>
      </span>

      <span style="padding:5px">
        <mat-form-field>
          <mat-label>Select Environment</mat-label>
          <mat-select  [(ngModel)]="selectedEnvironment">
              <mat-option *ngFor="let environment of environments" [value]="environment.environmentId" >{{environment.environmentName}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </span>

      <span style="padding:5px">
      <button (click)="reset_all()" matTooltip="Reset"><i class="fa fa-undo"></i></button>
      </span>
  </div>


  <div class="form-group pull-right">
        <span style="padding:5px">
          <button [disabled]="selectedvalue=='' || selectedEnvironment==''" matTooltip="Start Process"   mat-mini-fab color="basic" (click)="startprocess()"   title="Run Process"><i  class="fas fa-play"></i></button>
        </span>
       <!-- <span style="padding:5px">
          <button [disabled]="selectedvalue=='' || selectedEnvironment==''" matTooltip="Pause Process" mat-mini-fab color="basic" (click)="startprocess()"   title="Run Process"><i  class="fas fa-pause"></i></button>
        </span>
        -->
        <span style="padding:5px">
          <button [disabled]="selectedvalue==''"  mat-mini-fab color="basic"   matTooltip="Open Scheduler" (click)="startscheduler()" ><i class="fa fa-calendar"></i></button>
        </span>
        <span style="padding:5px">
          <button [disabled]="selectedvalue==''"  mat-mini-fab color="basic"  matTooltip="View Logs"  (click)="getprocesslogs()"  ><i class="fa fa-file" aria-hidden="true"></i></button>
        </span>
  </div>

</div>
</div>


<div class="container-fluid">
<mat-card>
  <div  *ngIf="responsedata!=undefined" style="width:100%;overflow-x: scroll;">

    <table mat-table #sort10="matSort" [dataSource]="dataSource2" matSort class=" table">

        <ng-container matColumnDef="processName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Process Name</th>
            <td mat-cell *matCellDef="let element"> {{element.processName}}</td>
        </ng-container>


        <ng-container matColumnDef="taskName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Task</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="element.taskName!=null">{{element.taskName}}</span>
                <span *ngIf="element.taskName==null">---</span>
            </td>
        </ng-container>
        <ng-container matColumnDef="taskType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Automated & Human</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="element.taskName!=null">{{element.taskType}}</span>
                <span *ngIf="element.taskName==null">---</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Category</th>
          <td mat-cell *matCellDef="let element">
              <span *ngIf="element.category!=null">{{element.category}}</span>
              <span *ngIf="element.category==null">---</span>
          </td>
      </ng-container>
        <ng-container matColumnDef="Assign">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Assign Resource</th>
            <td mat-cell *matCellDef="let element">

            <span *ngIf="element.taskType=='Bot' || element.taskType=='Automated'">
              <select class="form-control" style="width:200px;"  [value]="element.botId" [id]="element.taskId+'__select'">
                  <option value="0" >Select Resource</option>
                  <option *ngFor="let bot of (bot_list | botlistbycat : element.categoryId)" [value]="bot.botId"  [selected]="bot.botId == element.botId">{{bot.botName}}</option>
              </select>
            </span>
            <span *ngIf="element.taskType=='Human'">
              <select class="form-control" style="width:200px;"   [id]="element.taskId+'__select'">
                  <option value="0" >Select Resource</option>
                  <option *ngFor="let human of humans_list">{{human.userId.firstName}} {{human.userId.lastName}} </option>
              </select>
            </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="element.status!='null'" [id]="element.taskId+'__status'">
              <span *ngIf="element.status=='InProgress'" class="text-primary" ><span><img src='../../../../assets/images/RPA/processloading.svg' style='height:25px'></span>&nbsp;<span>{{element.status}}</span></span>
                <span *ngIf="element.status=='Success'" class="text-success"><span><li class="fa fa-check"></span>&nbsp;<span>{{element.status}}</span></span>
                <span *ngIf="element.status=='New'" class="text-primary"><span><img src="/assets/images/RPA/newicon.png" style="height:20px;"></span>&nbsp;<span>{{element.status}}</span></span>
                <span *ngIf="element.status=='Failed'" class="text-danger"><span><li class="fa fa-times"></span>&nbsp;<span>{{element.status}}</span></span>
                </span>

                <span *ngIf="element.status=='null'">---</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="successTask">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Success</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="element.successTask!='null'" [id]="element.taskId+'__success'">{{element.successTask}}</span>
                <span *ngIf="element.successTask=='null'">---</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="failureTask">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Failure</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="element.failureTask!='null'" [id]="element.taskId+'__failed'">{{element.failureTask}}</span>
                <span *ngIf="element.failureTask=='null'">---</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="Operations">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let element">

                <span>
                  <button (click)="createtaskbotoverlay(element.taskId)" matTooltip="Create and Assign Bot">
                    <i  class="fas fa-plus text-primary"></i>
                  </button>
                </span>

                <span>
                  <button (click)="assignbot(element.taskId)"  matTooltip="Assign Bot"><i  class="fas fa-check text-success"></i></button>
                </span>

                <span>
                  <button (click)="resetbot(element.taskId)" matTooltip="Reset"><i  class="fas fa-sync-alt"></i></button>
                </span>
            </td>
        </ng-container>
        <ng-container matColumnDef="noData">
            <td mat-footer-cell class="mat-footer" style="text-align:center" *matFooterCellDef colspan="6">
                No Records Found
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr class="row-highlight" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr class="row-highlight mat-footer" mat-footer-row *matFooterRowDef="['noData']" [ngClass]="{'hide':!(dataSource2!=null && dataSource2.data.length==0)}"></tr>
    </table>


  </div>
  <mat-paginator #paginator10 [pageSize]="8" [showFirstLastButtons]="true">
  </mat-paginator>
</mat-card>

<br>
<br>
</div>
</div>

<div *ngIf="popup">
  <div id='logsid' class="rpa-modal" style="display:block">
      <div class="rpa-modal-content">
          <div class="rpa-modal-header">
              <span class="rpa-modal-close" (click)="closepop()">&times;</span>
              <h4>Logs</h4>
          </div>
          <div class="rpa-modal-body">
            <app-so-processlog [processId]="processId1"></app-so-processlog>
          </div>
      </div>
  </div>
</div>



<div *ngIf="schedulepopup">
  <div id='sch' class="rpa-modal" style="display:block">
      <div class="rpa-modal-content">
          <div class="rpa-modal-header">
              <span class="rpa-modal-close" (click)="closescheduler()">&times;</span>
              <h4>Scheduler</h4>
          </div>
          <div class="rpa-modal-body">
              <app-so-scheduler [data]="schdata" id="Scheduler"></app-so-scheduler>
          </div>
      </div>
  </div>
</div>
