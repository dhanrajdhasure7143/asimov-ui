
<div class="row new-PI-layout">
                <div class='col-md-12 PI-uploadgrid p-0'>
                  <div class="row">
                   <div class="PI-heading">
                        <label class="maintitle PI-heading">Connect Your Data</label>
                        <h4 class="subtitle">Choose below options to get your data</h4>
                   </div>     
                   <div class="col-md-3 upload_zone" id="upload_xl" *ngIf="this.isButtonVisible || enableuploadbuttons">
                        <ngx-dropzone (change)="onUpload($event,0)" [multiple]=false [accept]="xlsx_csv_mime" >
                           <div class="model-img">       
                                <ngx-dropzone-label>
                                        <img src ="../../../../assets/images/PI/CSV.svg">
                                </ngx-dropzone-label>
                           </div>
                           <div class="model-text">         
                                <h3>XLSX/CSV</h3>
                                <h5>Upload</h5>
                           </div>
                           <div class="model-uploadhvr">
                                <img src="../../../../assets/images/PI/upload.svg">
                           </div>
                        </ngx-dropzone>
                   </div>
                   <div class="col-md-3 upload_zone" id="upload_xes" *ngIf="this.isButtonVisible || enableuploadbuttons">
                        <ngx-dropzone (change)="onUpload($event,3)" [multiple]=false accept=".xes, .gzip, .gz" >
                           <div class="model-img">
                                <ngx-dropzone-label>
                                        <img src ="../../../../assets/images/PI/XES.svg">
                                </ngx-dropzone-label>
                           </div>
                           <div class="model-text">
                                <h3>XES</h3>
                                <h5>Upload</h5>
                           </div>
                           <div class="model-uploadhvr">
                                   <img src="../../../../assets/images/PI/upload.svg">
                           </div>                        
                        </ngx-dropzone>
                   </div>
                   <div class="col-md-3 upload_zone" id="upload_db" (click)="onDbSelect()" *ngIf="this.isButtonVisible || enableuploadbuttons">
                        <ngx-dropzone [multiple]=false [accept]="db_mime" [disableClick]=true >
                           <div class="model-img">
                                <ngx-dropzone-label>
                                        <img src ="../../../../assets/images/PI/DB.svg">
                                </ngx-dropzone-label>
                           </div>
                           <div class="model-text">
                                <h3>DB File</h3>
                                <h5>Create New</h5>
                           </div>
                           <div class="model-uploadhvr">
                                <img src="../../../../assets/images/PI/db-plus.svg">
                           </div>
                        </ngx-dropzone>
                   </div>
                   <div class="col-md-2 download_link" id="download_template">
                        <a (click)="downloadCSV()">Download Sample Template</a>
                   </div>
                  </div>
                </div>
                <div class="col-md-12 PI-workspace-table p-0" id="my_workspace">
                    <div class="row">
                        <div class='col-md-6 pl-0'>
                                <h4 class="box-heading">My Workspace</h4>
                        </div>
                        <form action="" class="col-md-6 p-0 tableControls">
                                        <div class="col-md-6 form-group pr-0 offset-4">
                                                <!-- <label>Select Category</label> -->
                                                <select  name="category" (selectionChange)="searchByCategory(categoryName)" #category="ngModel" [(ngModel)]="categoryName" panelClass="overlayMatSelect" class="form-control bps-home-fileds">
                                                        <option value="" disabled hidden >Select Category</option>
                                                        <option value="null" disabled hidden >Select Category</option>
                                                        <option value="undefined" disabled hidden >Select Category</option>
                                                        <option value="allcategories">All Categories</option>
                                                        <option *ngFor="let eachcat of categoryList.data;let i=index;trackBy:loopTrackBy" [value]="eachcat.categoryName">
                                                        {{eachcat.categoryName}}</option>
                                                </select>
                                        </div>
                                        <div class="col-md-6 form-group pr-0 PI-serwksp">
                                                <!-- <label>Search Workspace</label> -->
                                                <input (keyup)="applyFilter($event)" class="form-control toolbar-search bps-home-fileds" placeholder="Search Workspace">
                                                <img src="../../../../assets/images/search.svg" alt="" class="testplus1">
                                        </div>
                                        
                        </form>
                    </div>
                    <div class="col-sm-12 graph_table">
                        <table mat-table [dataSource]="dataSource" matSort class="PI table w-100">
                                <ng-container matColumnDef="piId">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header">Process ID </th>
                                        <td mat-cell *matCellDef="let element"> {{element.piId}} </td>
                                </ng-container>
                                <ng-container matColumnDef="createdTime">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header">Date</th>
                                        <td mat-cell *matCellDef="let element">{{element.convertedTime | date:'medium'}}</td>
                                </ng-container>
                                <ng-container matColumnDef="piName">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header">Process Name</th>
                                        <td mat-cell *matCellDef="let element">{{element.piName}}</td>
                                </ng-container>
                                <ng-container matColumnDef="categoryName">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header">Category</th>
                                        <td mat-cell *matCellDef="let element">{{element.categoryName?getcategoryName(element.categoryName):'-'}} </td>
                                </ng-container>
                                <ng-container matColumnDef="status">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header">Status</th>
                                        <td mat-cell *matCellDef="let element">{{element.status}} </td>
                                </ng-container>
                                <ng-container matColumnDef="action">
                                        <th mat-header-cell *matHeaderCellDef class="table_header">Action</th>
                                        <td mat-cell *matCellDef="let element" class="process_view">
                                                <span  *ngIf='element.kafkaConFail != "Y"' title="View Process Graph" (click)="onGraphSelection(element)">
                                                        <img src="../../../../assets/images/PI/eye-show.svg" alt="" class="testplus default-img">
                                                        <img src="../../../../assets/images/PI/eye-show-blue.svg" alt="" class="testplus hover-img">
                                                </span>
                                                <span *ngIf='element.kafkaConFail == "Y"' title="Retry Process Graph" (click)="onRetryGraphGenerate(element)">
                                                        <img src="../../../../assets/images/PI/refresh.svg" alt="" class="testplus default-img">
                                                        <img src="../../../../assets/images/PI/refresh-blue.svg" alt="" class="testplus hover-img">
                                                </span>
                                        </td>
                                </ng-container>                                  
                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="pList"></tr>
                        </table>
                        <div class="">
                                <mat-paginator class="newpaginationdiv" #paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true"></mat-paginator>
                        </div>        
                    </div>
                </div>
</div>

<div class="bpmnCreate">
     <div id="myModal1" class="modal">
        <div class="modal-content">
                <div class="modal-header">
                        <span class="close" (click)="closePopup();">&times;</span>
                        <h4>Database</h4>
                </div>
                <div class="modal-body databaseForm">
                        <form autocomplete="off" class="" #database="ngForm">
                                <div class="container m-contanier form-body">
                                        <div class="col-md-12 p-0 form-group">
                                           <div class="col-md-6 pl-0">
                                                <label class="label-control" for="type">Type<span class="star">*</span></label>
                                                <select class="form-control" name="type" id="type" #type="ngModel" (change)="changeType()" [(ngModel)]="dbDetails.dbType" required>
                                                        <option [value]="undefined" disabled hidden>Select Type</option>
                                                        <option value="postgresql">Postgres SQL</option>
                                                </select>
                                                <span *ngIf="((type.invalid && database.submitted) || (type.errors && type.touched) )" 
                                                        class='errspan required'> Type is required </span>
                                           </div>
                                           <div class="col-md-6 pr-0">
                                                <label class="label-control" for="connection">Connection Name<span class="star">*</span></label>
                                                <input type="text" name="connection" #connection="ngModel" [(ngModel)]="dbDetails.connectionName" class="form-control" placeholder="Enter Connection Name" required/>
                                                <span *ngIf="((connection.invalid && database.submitted) || (connection.errors && connection.touched) )" 
                                                        class='errspan required'> Connection Name is required </span>                                   
                                           </div>                
                                        </div>
                                        <div class="col-md-12 p-0 form-group">
                                           <div class="col-md-6 pl-0">
                                                <label class="label-control" for="hostname">Host Name / IP<span class="star">*</span></label>
                                                <input type="text" name="hostname" #hostname="ngModel" [(ngModel)]="dbDetails.hostName" class="form-control" placeholder="Enter Host Name" required 
                                                [readonly]="!dbDetails.dbType || !dbDetails.portNumber || !dbDetails.dbName || !dbDetails.userName || !dbDetails.password"/>
                                                <span *ngIf="((hostname.invalid && database.submitted) || (hostname.errors && hostname.touched) )" 
                                                        class='errspan required'> Host Name/IPis required </span>
                                           </div>
                                           <div class="col-md-6 pr-0">
                                                <label class="label-control" for="otherPort">Port Number<span class="star">*</span></label>
                                                <input type="text" name="otherPort" #otherPort='ngModel' [(ngModel)]="dbDetails.portNumber" class="form-control" placeholder="Enter Port Number" required/>
                                                <span *ngIf="((otherPort.invalid && database.submitted) || (otherPort.errors && otherPort.touched) )" 
                                                class='errspan required'>Port Number is required </span>
                                           </div>
                                        </div>
                                        <div class="col-md-12 p-0 form-group">
                                           <div class="col-md-6 pl-0">
                                                <label class="label-control" for="dbname">DB Name<span class="star">*</span></label>
                                                <input type="text" name="dbname" #dbname='ngModel' [(ngModel)]="dbDetails.dbName" class="form-control" placeholder="Enter DB Name" required/>
                                                <span *ngIf="((dbname.invalid && database.submitted) || (dbname.errors && dbname.touched) )" 
                                                class='errspan required'> DB Name is required </span>
                                           </div>
                                           <div class="col-md-6 pr-0">
                                                <label class="label-control" for="username">User Name<span class="star">*</span></label>
                                                <input type="text" name="username" #username='ngModel' class="form-control" [(ngModel)]='dbDetails.userName' placeholder="Enter User Name" required/>
                                                <span *ngIf="((username.invalid && database.submitted) || (username.errors && username.touched) )" 
                                                        class='errspan required'> User Name is required </span>
                                           </div>
                                        </div>
                                        <div class="col-md-6 pl-0">
                                                <label class="label-control" for="password">Password<span class="star">*</span></label>
                                                <input type="password" name="password" #password='ngModel' [(ngModel)]='dbDetails.password' (keyup)="onKeyUpPassword()" class="form-control" placeholder="Enter Password" required/>
                                                <span *ngIf="((password.invalid && database.submitted) || (password.errors && password.touched) )" 
                                                        class='errspan required'> Password is required </span>
                                              </div>
                                        <div [hidden]="!isTableEnable">
                                           <div class="col-md-12 p-0 form-group">
                                              <div class="col-md-6 pl-0">
                                                <label class="label-control" for="tablename">Table Name<span class="star">*</span></label>
                                                <select [disabled]="!dbDetails.hostName" class="form-control" name="tablename" id="tablename" #tablename='ngModel' [(ngModel)]="dbDetails.tableName" (change)="onChangeTable()" required>
                                                        <option [value]="undefined" disabled hidden>Select Table Name</option>
                                                        <option [value]="null" disabled hidden>Select Table Name</option>
                                                        <option *ngFor="let tName of tableList" value="{{tName}}">{{tName}}</option>
                                                </select>
                                                <span *ngIf="tablename.errors && tablename.touched" class='errspan required'> Table Name is required </span>
                                              </div>                                              
                                           </div>        
                                        </div>
                                        <div *ngIf="isTableEnable">
                                           <div class="col-md-12 p-0 form-group">
                                              <div class="col-md-6">
                                                <label class="label-control" for="increase">Mode<span class="star">*</span></label>
                                                <select [disabled]="!dbDetails.tableName" name="increase"  id="" class="form-control" (change)="onChangeMode($event.target.value)" #increase="ngModel" [(ngModel)]="dbDetails.mode" required>
                                                        <option [value]="undefined" disabled hidden>Select Mode</option>
                                                        <option [value]="null" disabled hidden>Select Mode</option>
                                                        <option value="incrementing">Incrementing</option>
                                                        <option value="timestamp">Timestamp</option>
                                                        <option value="timestamp+incrementing">Incrementing with Timestamp</option>
                                                </select> 
                                                <span *ngIf="((increase.invalid && database.submitted) || (increase.errors && increase.touched) )" 
                                                class='errspan required'> Mode is required </span>
                                              </div>
                                              <div class="col-md-6">
                                                <div *ngIf="isIncrement" >
                                                        <label class="label-control" for="increment">Increment Column name<span class="star">*</span></label>
                                                        <input type="text" name="increment" class="form-control" #increment [(ngModel)]='dbDetails.increment' placeholder="Enter increment column name" required/>
                                                        <span *ngIf="((increment.invalid && database.submitted) || (increment.errors && increment.touched) )" 
                                                             class='errspan required'> Increment column name is required </span>
                                                      </div>
                                                      <div *ngIf="isTimestammp">
                                                        <label class="label-control" for="timestamp">Timestamp Column Name<span class="star">*</span></label>
                                                        <input type="text" name="timestamp" #timestamp class="form-control" [(ngModel)]='dbDetails.timestamp' placeholder="Enter Timestamp column name" required/>
                                                        <span *ngIf="((timestamp.invalid && database.submitted) || (timestamp.errors && timestamp.touched) )" 
                                                             class='errspan required'> Timestamp column name is required </span>
                                                      </div>
                                              </div>
                                           </div>
                                        </div>
                                        <!-- <div class="increment_input"></div> -->          
                                </div>
                                <div class="form-footer">
                                        <div class="featchTbale-btn" *ngIf="!isTableEnable">
                                                <button class="btn eiap-btn btn-primary" [disabled]="!dbDetails.hostName" (click)="getDBTables()">Fetch Tables</button>
                                        </div>
                                        <div class="connection_btn">
                                                <button class='btn btn-primary' [disabled]='database.invalid' (click)="testDbConnection()">Test Connection</button>
                                                <button class='btn btn-primary db-gpg-btn' [disabled]='isDisabled' (click)="slideUp()">Generate Process Graph</button>
                                        </div>                                       
                                </div>        
                        </form>
                </div>
        </div>
     </div>
</div>

<process-category-overlay headerTitle="Save Process" buttonName="Save & Generate" (proceed)="generateGraph($event)" class="bpmnCreate"></process-category-overlay>
<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "ball-spin-clockwise-fade-rotating" [fullScreen] = "true"><p style="color: white" ></p></ngx-spinner>