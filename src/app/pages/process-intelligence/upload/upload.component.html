
<div class="row new-PI-layout ">
        <div class='col-md-12 PI-uploadgrid p-0'>
          <div class="row">
           <div class="PI-heading">
                <label class="maintitle PI-heading">Connect Your Data</label>
                <h4 class="subtitle">Choose from the following file formats to upload your data. | 
                        <span class=" download_link" id="download_template">
                                <a (click)="downloadCSV()">Download Sample Template</a>
                        </span>
                </h4>
                
           </div>     
           <div class="col-md-3 p-0 upload_zone" id="upload_xl" >
                <ngx-dropzone (change)="onUpload($event,0)" [multiple]=false [accept]="xlsx_csv_mime" >
                   <div class="model-img">       
                        <ngx-dropzone-label>
                                <img src ="../../../../assets/images/PI/CSV.svg">
                        </ngx-dropzone-label>
                   </div>
                   <div class="model-text">         
                        <h3>XLSX/CSV</h3>
                        <!-- <h5>Upload</h5> -->
                   </div>
                   <div class="model-uploadhvr">
                        <img src="../../../../assets/images/PI/upload.svg">
                   </div>
                </ngx-dropzone>
           </div>
           <div class="col-md-3 p-0 upload_zone" id="upload_xes" *ngIf="freetrail!='true'">
                <ngx-dropzone (change)="onUpload($event,3)" [multiple]=false accept=".xes, .gzip, .gz" >
                   <div class="model-img">
                        <ngx-dropzone-label>
                                <img src ="../../../../assets/images/PI/XES.svg">
                        </ngx-dropzone-label>
                   </div>
                   <div class="model-text">
                        <h3>XES</h3>
                        <!-- <h5>Upload</h5> -->
                   </div>
                   <div class="model-uploadhvr">
                           <img src="../../../../assets/images/PI/upload.svg">
                   </div>                        
                </ngx-dropzone>
           </div>
           <div class="col-md-3 p-0 upload_zone" id="upload_db" (click)="onDbSelect()" *ngIf="freetrail!='true'">
                <ngx-dropzone [multiple]=false [accept]="db_mime" [disableClick]=true >
                   <div class="model-img">
                        <ngx-dropzone-label>
                                <img src ="../../../../assets/images/PI/DB.svg">
                        </ngx-dropzone-label>
                   </div>
                   <div class="model-text">
                        <h3>DB File</h3>
                        <!-- <h5>Create New</h5> -->
                   </div>
                   <div class="model-uploadhvr">
                        <img src="../../../../assets/images/PI/db-plus.svg">
                   </div>
                </ngx-dropzone>
           </div>
           <!-- <div class="col-md-2 download_link" id="download_template">
                <a (click)="downloadCSV()">Download Sample Template</a>
           </div> -->
          </div>
        </div>
        <div class="col-md-12 PI-workspace-table p-0" id="my_workspace">
            <div class="row">
                <div class='col-md-6 pl-0'>
                        <h4 class="box-heading">My Workspace</h4>
                </div>
                <form action="" class="col-md-6 p-0 tableControls">
                                <div class="col-md-6 form-group pr-0 offset-4">
                                        <!-- <label>Select Category</label> -->
                                        <select  name="category" (change)="searchByCategory(categoryName)" [disabled]="categories_list.length == 1" #category="ngModel" [(ngModel)]="categoryName" panelClass="overlayMatSelect" class="form-control bps-home-fileds">
                                                <option value="" disabled hidden >Select Category</option>
                                                <option value="null" disabled hidden >Select Category</option>
                                                <option value="undefined" disabled hidden >Select Category</option>
                                                <option value="allcategories" *ngIf="categories_list.length > 1">All Categories</option>
                                                <option *ngFor="let eachcat of categories_list;let i=index;trackBy:loopTrackBy" [value]="eachcat.categoryName">
                                                {{eachcat.categoryName}}</option>
                                        </select>
                                </div>
                                <div class="col-md-6 form-group pr-0 PI-serwksp">
                                        <!-- <label>Search Workspace</label> -->
                                        <input (keyup)="applyFilter($event)" class="form-control toolbar-search bps-home-fileds" placeholder="Search Workspace">
                                        <img src="../../../../assets/images/search.svg" alt="" class="testplus1">
                                </div>
                                
                </form>
            </div>
            <div class="test1">
                <div class="col-sm-12 graph_table">
                   <table mat-table [dataSource]="dataSource" matSort class="PI table w-100">
                        <ng-container matColumnDef="piId">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell1">Process ID </th>
                                <td mat-cell *matCellDef="let element" class="pcell1"> {{element.piId}} </td>
                        </ng-container>
                        <ng-container matColumnDef="createdTime">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell2">Created Date</th>
                                <td mat-cell *matCellDef="let element" class="pcell2">{{element.convertedTime_new}}</td>
                        </ng-container>
                        <ng-container matColumnDef="piName">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell3">Process Name</th>
                                <td mat-cell *matCellDef="let element" class="pcell3">{{element.piName}}</td>
                        </ng-container>
                        <ng-container matColumnDef="categoryName">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell4">Category</th>
                                <td mat-cell *matCellDef="let element" class="pcell4">{{element.categoryName?getcategoryName(element.categoryName):'-'}} </td>
                        </ng-container>
                        <ng-container matColumnDef="status">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell5">Status</th>
                                <td mat-cell *matCellDef="let element" class="pcell5">{{element.status}} </td>
                        </ng-container>
                        <ng-container matColumnDef="action">
                                <th mat-header-cell *matHeaderCellDef class="table_header pcell6">Action</th>
                                <td mat-cell *matCellDef="let element" class="process_view pcell6">
                                        <span  *ngIf='element.kafkaConFail != "Y"' (click)="onGraphSelection(element)">
                                                <img src="../../../../assets/images/PI/eye-show.svg" alt="" class="testplus default-img" matTooltip="View Process Graph" matTooltipPosition="left">
                                                <img src="../../../../assets/images/PI/eye-show-blue.svg" alt="" class="testplus hover-img" matTooltip="View Process Graph" matTooltipPosition="left">
                                        </span>
                                        <span *ngIf='element.kafkaConFail == "Y"' (click)="onRetryGraphGenerate(element)">
                                                <img src="../../../../assets/images/PI/refresh.svg" alt="" class="testplus default-img" matTooltip="Retry Process Graph" matTooltipPosition="left">
                                                <img src="../../../../assets/images/PI/refresh-blue.svg" alt="" class="testplus hover-img" matTooltip="Retry Process Graph" matTooltipPosition="left">
                                        </span>
                                        <span  (click)="editProcess(element)" matTooltip="Edit" class="newinntalx">
                                                <img src="../../../../assets/images/Projects/edit-black.svg" class="default-img">
                                                <img src="../../../../../assets/images/Projects/Edit-blue.svg" class="hover-img">
                                        </span> 
                                        <span>
                                                <span *ngIf="element.status !='Inprogress'" (click)="onDeleteSelectedProcess(element.piId,element)" class="delete-icon">
                                                        <!-- <img matTooltip="Delete Process" matTooltipPosition="left" src="../../../../assets/images/BPMS/delete-red.svg"  > -->
                                                        <img src="../../../../assets/images/Projects/delete-black.svg" matTooltip="Delete Process" matTooltipPosition="left" class="default-img">
                                                        <img src="../../../../assets/images/Projects/delete-red.svg" matTooltip="Delete Process" matTooltipPosition="left" class="hover-img">
                                                </span>
                                                <span *ngIf="element.status=='Inprogress'" class="delete-icon delete-icon-disabled">
                                                        <img matTooltip="Delete Process" matTooltipPosition="left" src="../../../../assets/images/PI/delete_disabled.svg"  >
                                                </span>
                                        </span>

                                </td>
                        </ng-container>                                  
                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="pList"></tr>
                   </table>
                </div>
                <div class="pipaginationdiv">
                     <mat-paginator class="newpaginationdiv" #paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true"></mat-paginator>
                </div>        
            </div>
        </div>
</div>

<div class="bpmnCreate">
<div id="myModal1" class="modal">
<div class="modal-content">
        <div class="modal-header">
                <span class="close" (click)="closePopup();database.reset()">&times;</span>
                <h4>Database</h4>
        </div>
        <div class="modal-body databaseForm">
                <form autocomplete="off" class="" #database="ngForm">
                        <div class="container m-contanier form-body">
                                <div class="col-md-12 p-0 form-group">
                                   <div class="col-md-6 pl-0">
                                        <label class="label-control" for="type">Type<span class="star">*</span></label>
                                        <select class="form-control" name="type" id="type" #type="ngModel" (change)="changeType()" [(ngModel)]="dbDetails.dbType" required>
                                                <option [value]="undefined" disabled hidden>Select Type</option>
                                                <option value="null" disabled hidden>Select Type</option>
                                                <option value="postgresql">Postgres SQL</option>
                                        </select>
                                        <span *ngIf="((type.invalid && database.submitted) || (type.errors && type.touched) )" 
                                                class='errspan required'> Type is required </span>
                                   </div>
                                   <div class="col-md-6 pr-0">
                                        <label class="label-control" for="connection">Connection Name<span class="star">*</span></label>
                                        <input type="text" name="connection" #connection="ngModel" [(ngModel)]="dbDetails.connectionName" class="form-control" placeholder="Enter Connection Name" required/>
                                        <span *ngIf="((connection.invalid && database.submitted) || (connection.errors && connection.touched) )" 
                                                class='errspan required'> Connection Name is required </span>                                   
                                   </div>                
                                </div>
                                <div class="col-md-12 p-0 form-group">
                                        <div class="col-md-6 pl-0">
                                                <label class="label-control" for="dbname">DB Name<span class="star">*</span></label>
                                                <input type="text" name="dbname" #dbname='ngModel' (keyup)="onChangeValues()" [(ngModel)]="dbDetails.dbName" class="form-control" placeholder="Enter DB Name" required/>
                                                <span *ngIf="((dbname.invalid && database.submitted) || (dbname.errors && dbname.touched) )" 
                                                class='errspan required'> DB Name is required </span>
                                        </div>
                                  
                                   <div class="col-md-6 pr-0">
                                        <label class="label-control" for="otherPort">Port Number<span class="star">*</span></label>
                                        <input type="text" name="otherPort" #otherPort='ngModel' (keyup)="onChangeValues()" [(ngModel)]="dbDetails.portNumber" class="form-control" placeholder="Enter Port Number" required/>
                                        <span *ngIf="((otherPort.invalid && database.submitted) || (otherPort.errors && otherPort.touched) )" 
                                        class='errspan required'>Port Number is required </span>
                                   </div>
                                </div>
                                
                                <div class="col-md-12 p-0 form-group">
                                        <div class="col-md-6 pl-0">
                                                <label class="label-control" for="username">User Name<span class="star">*</span></label>
                                                <input type="text" name="username" #username='ngModel' (keyup)="onChangeValues()" class="form-control" [(ngModel)]='dbDetails.userName' placeholder="Enter User Name" required/>
                                                <span *ngIf="((username.invalid && database.submitted) || (username.errors && username.touched) )" 
                                                        class='errspan required'> User Name is required </span>
                                        </div>
                                        <div class="col-md-6 pr-0">
                                                <label class="label-control" for="password">Password<span class="star">*</span></label>
                                                <input type="password" name="pass_word" #pass_word='ngModel' [(ngModel)]='dbDetails.password' (keyup)="onKeyUpPassword()" class="form-control" placeholder="Enter Password" required/>
                                                <span *ngIf="((pass_word.invalid && database.submitted) || (pass_word.errors && pass_word.touched) )" 
                                                        class='errspan required'> Password is required </span>
                                        </div>
                                </div>
                                <div class="col-md-12 p-0 form-group">
                                        <div class="col-md-6 pl-0">
                                                <label class="label-control" for="hostname">Host Name / IP<span class="star">*</span></label>
                                                <input type="text" name="hostname" #hostname="ngModel" (keyup)="onChangeValues()" [(ngModel)]="dbDetails.hostName" class="form-control" placeholder="Enter Host Name" required 
                                                [readonly]="!dbDetails.dbType || !dbDetails.portNumber || !dbDetails.dbName || !dbDetails.userName || !dbDetails.password"/>
                                                <span *ngIf="hostname.errors && hostname.touched" 
                                                        class='errspan required'> Host Name/IPis required </span>
                                        </div>
                                </div>
                                <div class="col-md-12 p-0 form-group">
                                   <div [hidden]="!isTableEnable">
                                      <div class="col-md-6 pl-0">
                                        <label class="label-control" for="tablename">Table Name<span class="star">*</span></label>
                                        <select [disabled]="!dbDetails.hostName" class="form-control" name="tablename" id="tablename" #tablename='ngModel' [(ngModel)]="dbDetails.tableName" (change)="onChangeTable()" required>
                                                <option [value]="undefined" disabled hidden>Select Table Name</option>
                                                <option [value]="null" disabled hidden>Select Table Name</option>
                                                <option value="" disabled hidden>Select Table Name</option>
                                                <option *ngFor="let tName of tableList" value="{{tName}}">{{tName}}</option>
                                        </select>
                                        <span *ngIf="tablename.errors && tablename.touched" class='errspan required'> Table Name is required </span>
                                      </div>                                              
                                   </div>
                                        <div class="col-md-6 pr-0" *ngIf="isTableEnable">
                                                <label class="label-control" for="increase">Mode<span class="star">*</span></label>
                                                <select [disabled]="!dbDetails.tableName" name="increase"  id="" class="form-control" (change)="onChangeMode($event.target.value)" #increase="ngModel" [(ngModel)]="dbDetails.mode" required>
                                                        <option [value]="undefined" disabled hidden>Select Mode</option>
                                                        <option [value]="null" disabled hidden>Select Mode</option>
                                                        <option value="" disabled hidden>Select Mode</option>
                                                        <option *ngFor="let each of modesList" [value]="each.value">{{each.name}}</option>
                                                </select> 
                                                <span *ngIf="increase.errors && increase.touched" 
                                                class='errspan required'> Mode is required </span>
                                        </div>
                                </div>      
                                
                                <div *ngIf="isTableEnable">
                                   <div class="col-md-12 p-0 form-group">
                                      <!-- <div class="col-md-6">
                                        <label class="label-control" for="increase">Mode<span class="star">*</span></label>
                                        <select [disabled]="!dbDetails.tableName" name="increase"  id="" class="form-control" (change)="onChangeMode($event.target.value)" #increase="ngModel" [(ngModel)]="dbDetails.mode" required>
                                                <option [value]="undefined" disabled hidden>Select Mode</option>
                                                <option [value]="null" disabled hidden>Select Mode</option>
                                                <option value="incrementing">Incrementing</option>
                                                <option value="timestamp">Timestamp</option>
                                                <option value="timestamp+incrementing">Incrementing with Timestamp</option>
                                        </select> 
                                        <span *ngIf="((increase.invalid && database.submitted) || (increase.errors && increase.touched) )" 
                                        class='errspan required'> Mode is required </span>
                                      </div> -->
                                      <!-- <div > -->
                                        <div class="col-md-6 pl-0" *ngIf="isIncrement" >
                                                <label class="label-control" for="increment">Increment Column name<span class="star">*</span></label>
                                                <input type="text" name="increment" class="form-control" #increment="ngModel" [(ngModel)]='dbDetails.increment' placeholder="Enter increment column name" required/>
                                                <span *ngIf="increment.errors && increment.touched" 
                                                     class='errspan required'> Increment column name is required </span>
                                              </div>
                                              <div class="col-md-6 pr-0" *ngIf="isTimestammp">
                                                <label class="label-control" for="timestamp">Timestamp Column Name<span class="star">*</span></label>
                                                <input type="text" name="timestamp" #timestamp="ngModel" class="form-control" [(ngModel)]='dbDetails.timestamp' placeholder="Enter Timestamp column name" required/>
                                                <span *ngIf="timestamp.errors && timestamp.touched" 
                                                     class='errspan required'> Timestamp column name is required </span>
                                              </div>
                                      <!-- </div> -->
                                   </div>
                                </div>
                                <!-- <div class="increment_input"></div> -->          
                        </div>
                        <div class="form-footer">
                                <div class="featchTbale-btn" *ngIf="!isTableEnable">
                                        <button class="btn eiap-btn btn-primary" [disabled]="!dbDetails.hostName" (click)="getDBTables()">Fetch Tables</button>
                                </div>
                                <div class="connection_btn">
                                        <button class='btn btn-primary' [disabled]='database.invalid' (click)="testDbConnection()">Test Connection</button>
                                        <button class='btn btn-primary db-gpg-btn' [disabled]='isDisabled' (click)="slideUp()">Generate Process Graph</button>
                                </div>                                       
                        </div>        
                </form>
        </div>
</div>
</div>
</div>


<process-category-overlay headerTitle="Save Process" [overlay_data]="overlay_data" buttonName="Save & Generate" (proceed)="generateGraph($event)" class="bpmnCreate"></process-category-overlay>
<!-- <ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "ball-spin-clockwise-fade-rotating" [fullScreen] = "true"><p style="color: white" ></p></ngx-spinner> -->



<div class="spinoverlay" *ngIf="isLoading">
<div class="spincenter">
    <img  src='..\assets\images\EZFlow_Loader.gif' class="ezflow-loader"/>
</div>
</div>