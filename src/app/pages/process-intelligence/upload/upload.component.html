<div class="maincontent">
        <div class="h-100">
            <div class="row main-content-head">
                <div class="col-md-5 new-bps-header-title p-0">
                    <h3>  
                        <span class="title_text">Process Intelligence</span>
                    </h3>
                  </div>
            </div>
            <div class="main-content-body tablist-cont">
                <div class="h-100">
                        <div class="new-PI-layout ">
                                <div class='PI-uploadgrid'>
                                  <div class="row">
                                   <div class="col PI-heading">
                                        <h4 class="colheads">Connect Your Data</h4>
                                        <label class="subtitle">Choose from the following file formats to upload your data. | 
                                                <span class=" download_link" id="download_template">
                                                        <a (click)="downloadCSV()">Download Sample Template</a>
                                                </span>
                                        </label>
                                   </div> 
                                  </div>
                                  <div class="row">    
                                   <div class="col-3 p-0 upload_zone" id="upload_xl" >
                                        <ngx-dropzone (change)="onUpload($event,0)" [multiple]=false [accept]="xlsx_csv_mime" >
                                           <div class="model-img">       
                                                <ngx-dropzone-label>
                                                        <img src ="../../../../assets/images/PI/CSV.svg">
                                                </ngx-dropzone-label>
                                           </div>
                                           <div class="model-text">         
                                                <h3>XLSX/CSV</h3>
                                           </div>
                                           <div class="model-uploadhvr">
                                                <img src="../../../../assets/images/PI/upload.svg">
                                           </div>
                                        </ngx-dropzone>
                                   </div>
                                   <div class="col-3 p-0 upload_zone" id="upload_xes" *ngIf="freetrail!='true'">
                                        <ngx-dropzone (change)="onUpload($event,3)" [multiple]=false accept=".xes, .gzip, .gz" >
                                           <div class="model-img">
                                                <ngx-dropzone-label>
                                                        <img src ="../../../../assets/images/PI/XES.svg">
                                                </ngx-dropzone-label>
                                           </div>
                                           <div class="model-text">
                                                <h3>XES</h3>
                                           </div>
                                           <div class="model-uploadhvr">
                                                   <img src="../../../../assets/images/PI/upload.svg">
                                           </div>                        
                                        </ngx-dropzone>
                                   </div>
                                   <div class="col-3 p-0 upload_zone" id="upload_db" (click)="onDbSelect()" *ngIf="freetrail!='true'">
                                        <ngx-dropzone [multiple]=false [accept]="db_mime" [disableClick]=true >
                                           <div class="model-img">
                                                <ngx-dropzone-label>
                                                        <img src ="../../../../assets/images/PI/DB.svg">
                                                </ngx-dropzone-label>
                                           </div>
                                           <div class="model-text">
                                                <h3>DB File</h3>
                                           </div>
                                           <div class="model-uploadhvr">
                                                <img src="../../../../assets/images/PI/db-plus.svg">
                                           </div>
                                        </ngx-dropzone>
                                   </div>
                                  </div>
                                </div>
                                <div class="col-md-12 PI-workspace-table p-0" id="my_workspace">
                                    <div class="row">
                                        <div class='col-md-6 p-0'>
                                                <h4 class="colheads">My Workspace</h4>
                                        </div>
                                        <!-- <form action="" class="col-md-6 p-0 tableControls">
                                                        <div class="col-md-6 form-group pr-0 offset-4">
                                                                <select  name="category" (change)="searchByCategory(categoryName)" [disabled]="categories_list.length == 1" #category="ngModel" [(ngModel)]="categoryName" panelClass="overlayMatSelect" class="form-control bps-home-fileds">
                                                                        <option value="" disabled hidden >Select Category</option>
                                                                        <option value="null" disabled hidden >Select Category</option>
                                                                        <option value="undefined" disabled hidden >Select Category</option>
                                                                        <option value="allcategories" *ngIf="categories_list.length > 1">All Categories</option>
                                                                        <option *ngFor="let eachcat of categories_list;let i=index;trackBy:loopTrackBy" [value]="eachcat.categoryName">
                                                                        {{eachcat.categoryName}}</option>
                                                                </select>
                                                        </div>
                                                        <div class="col-md-6 form-group pr-0 PI-serwksp">
                                                                <input (keyup)="applyFilter($event)" class="form-control toolbar-search bps-home-fileds" placeholder="Search Workspace">
                                                                <img src="../../../../assets/images/search.svg" alt="" class="testplus1">
                                                        </div>        
                                        </form> -->
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12 graph_table p-0 gridparentdiv">
                                                <app-dynamic-table 
                                                        [columns_list]="columns_list"
                                                        [table_data]="process_graph_list" 
                                                        (viewItem)="onGraphSelection($event)"
                                                        (deleteItem)="onDeleteSelectedProcess($event)" 
                                                        [screenTable]="'common'" 
                                                        [dataKeyId]="'piId'"
                                                        [search_fields]="table_searchFields" 
                                                        [show_view_btn]="true" 
                                                        [show_retry_btn]="true" 
                                                        [show_edit_btn]="true" 
                                                        [show_delete_btn]="true"
                                                        (retryById)="onRetryGraphGenerate($event)"
                                                        (updateItem)="editProcess($event)"
                                                        [categories_list]="categories_list"
                                                        [show_search_field]="true"
                                                        [show_column_filter]="true"
                                                        [show_clear_filter]="true"
                                                        (onRowDoubleClick)="onGraphSelection($event)">
                                                </app-dynamic-table>
                                           <!-- <table mat-table [dataSource]="dataSource" matSort class="PI table w-100">
                                                <ng-container matColumnDef="piId">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell1">Process ID </th>
                                                        <td mat-cell *matCellDef="let element" class="pcell1"> {{element.piId}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="createdTime">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell2">Created Date</th>
                                                        <td mat-cell *matCellDef="let element" class="pcell2">{{element.convertedTime_new}}</td>
                                                </ng-container>
                                                <ng-container matColumnDef="piName">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell3">Process Name</th>
                                                        <td mat-cell *matCellDef="let element" class="pcell3"> <span [matTooltip]="element.piName">{{element.piName}} </span></td>
                                                </ng-container>
                                                <ng-container matColumnDef="categoryName">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell4">Category</th>
                                                        <td mat-cell *matCellDef="let element" class="pcell4">{{element.categoryName?getcategoryName(element.categoryName):'-'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="status">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="table_header pcell5">Status</th>
                                                        <td mat-cell *matCellDef="let element" class="pcell5">{{element.status}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="action">
                                                        <th mat-header-cell *matHeaderCellDef class="table_header pcell6">Action</th>
                                                        <td mat-cell *matCellDef="let element" class="process_view pcell6">
                                                                <span  *ngIf='element.kafkaConFail != "Y"' (click)="onGraphSelection(element)" matTooltip="View Process Graph">
                                                                        <img src="../../../../assets/images/PI/eye-show.svg" alt="" class="testplus default-img" >
                                                                        <img src="../../../../assets/images/PI/eye-show-blue.svg" alt="" class="testplus hover-img" >
                                                                </span>
                                                                <span *ngIf='element.kafkaConFail == "Y"' (click)="onRetryGraphGenerate(element)" matTooltip="Retry Process Graph">
                                                                        <img src="../../../../assets/images/PI/refresh.svg" alt="" class="testplus default-img" >
                                                                        <img src="../../../../assets/images/PI/refresh-blue.svg" alt="" class="testplus hover-img" >
                                                                </span>
                                                                <span  (click)="editProcess(element)" matTooltip="Edit" class="newinntalx">
                                                                        <img src="../../../../assets/images/Projects/edit-black.svg" class="default-img">
                                                                        <img src="../../../../../assets/images/Projects/Edit-blue.svg" class="hover-img">
                                                                </span> 
                                                                <span>
                                                                        <span (click)="onDeleteSelectedProcess(element)" class="delete-icon" matTooltip="Delete Process">
                                                                                <img src="../../../../assets/images/Projects/delete-black.svg" class="default-img">
                                                                                <img src="../../../../assets/images/Projects/delete-red.svg" class="hover-img">
                                                                        </span>
                                                                </span>
                        
                                                        </td>
                                                </ng-container>
                                                <ng-container matColumnDef="noData">
                                                        <td mat-footer-cell class="mat-footer" style="text-align:center" *matFooterCellDef colspan="9">
                                                            <span *ngIf="!isLoading">No Records Found</span>
                                                        </td>
                                                    </ng-container>
                                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                                        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="pList"></tr>
                                                        <tr class="row-highlight mat-footer" mat-footer-row *matFooterRowDef="['noData']" [ngClass]="{'hide':!(process_graph_list.length==0)}"></tr>
                                           </table> -->
                                           <!-- <div class="noDataMessage" *ngIf="noDataMessage" >No Data Found</div> -->
                                                
                                        </div>
                                        <!-- <div class="pipaginationdiv">
                                             <mat-paginator class="newpaginationdiv" #paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true"></mat-paginator>
                                        </div>         -->
                                    </div>
                                </div>
                        </div>
    
                </div>
            </div>
        </div>
      </div>

<div class="" [hidden]="!hiddenPopUp">
<app-split-overlay (closeOverlay)="closeOverlay($event)"> 
<div class="h-100">

        <!-- <div class="modal-content">  -->
                        <div class="create-header">
                <h3>Database</h3>
                <!-- <span class="close" (click)="closePopup();database.reset()">&times;</span>                 -->
        </div>
        <div class="createform-overlay">
                <form autocomplete="off" class="h-100" #database="ngForm">
                        <div class="h-100" [ngClass]="{hasthreebtns: !isTableEnable, hastwobtns: isTableEnable}">
                                <div class="row">
                                   <div class="col-6 pl-0 form-group">
                                        <label class="label-control" for="type">Type<span class="star">*</span></label>
                                        <select class="form-control" name="type" id="type" #type="ngModel" (change)="changeType()" [(ngModel)]="dbDetails.dbType" required>
                                                <option [value]="undefined" disabled hidden>Select Type</option>
                                                <option value="null" disabled hidden>Select Type</option>
                                                <option value="postgresql">Postgres SQL</option>
                                        </select>
                                        <span *ngIf="((type.invalid && database.submitted) || (type.errors && type.touched) )" 
                                                class='required'> Type required </span>
                                   </div>
                                   <div class="col-6 pr-0 form-group">
                                        <label class="label-control" for="connection">Connection Name<span class="star">*</span></label>
                                        <input type="text" name="connection" #connection="ngModel" [(ngModel)]="dbDetails.connectionName" class="form-control" placeholder="Enter Connection Name" required/>
                                        <span *ngIf="((connection.invalid && database.submitted) || (connection.errors && connection.touched) )" 
                                                class='required'> Connection Name required </span>                                   
                                   </div>                
                                </div>
                                <div class="row">
                                        <div class="col-6 pl-0 form-group">
                                                <label class="label-control" for="dbname">DB Name<span class="star">*</span></label>
                                                <input type="text" name="dbname" #dbname='ngModel' (keyup)="onChangeValues()" [(ngModel)]="dbDetails.dbName" class="form-control" placeholder="Enter DB Name" required/>
                                                <span *ngIf="((dbname.invalid && database.submitted) || (dbname.errors && dbname.touched) )" 
                                                class='required'> DB Name required </span>
                                        </div>
                                  
                                   <div class="col-6 pr-0 form-group">
                                        <label class="label-control" for="otherPort">Port Number<span class="star">*</span></label>
                                        <input type="text" name="otherPort" #otherPort='ngModel' (keyup)="onChangeValues()" [(ngModel)]="dbDetails.portNumber" class="form-control" placeholder="Enter Port Number" required/>
                                        <span *ngIf="((otherPort.invalid && database.submitted) || (otherPort.errors && otherPort.touched) )" 
                                        class='required'>Port Number required </span>
                                   </div>
                                </div>                                
                                <div class="row">
                                        <div class="col-6 pl-0 form-group">
                                                <label class="label-control" for="username">User Name<span class="star">*</span></label>
                                                <input type="text" name="username" #username='ngModel' (keyup)="onChangeValues()" class="form-control" [(ngModel)]='dbDetails.userName' placeholder="Enter User Name" required/>
                                                <span *ngIf="((username.invalid && database.submitted) || (username.errors && username.touched) )" 
                                                        class='required'> User Name required </span>
                                        </div>
                                        <div class="col-6 pr-0 form-group">
                                                <label class="label-control" for="password">Password<span class="star">*</span></label>
                                                <input type="password" name="pass_word" #pass_word='ngModel' [(ngModel)]='dbDetails.password' (keyup)="onKeyUpPassword()" class="form-control" placeholder="Enter Password" required/>
                                                <span *ngIf="((pass_word.invalid && database.submitted) || (pass_word.errors && pass_word.touched) )" 
                                                        class='required'> Password required </span>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-6 pl-0 form-group">
                                                <label class="label-control" for="hostname">Host Name / IP<span class="star">*</span></label>
                                                <input type="text" name="hostname" #hostname="ngModel" [(ngModel)]="dbDetails.hostName" class="form-control" placeholder="Enter Host Name" required 
                                                [readonly]="!dbDetails.dbType || !dbDetails.portNumber || !dbDetails.dbName || !dbDetails.userName || !dbDetails.password"/>
                                                <span *ngIf="hostname.errors && hostname.touched" 
                                                        class='required'> Host Name/IP required </span>
                                        </div>
                                      <div class="col-6 pr-0 form-group" [hidden]="!isTableEnable">
                                        <label class="label-control" for="tablename">Table Name<span class="star">*</span></label>
                                        <select [disabled]="!dbDetails.hostName" class="form-control" name="tablename" id="tablename" #tablename='ngModel' [(ngModel)]="dbDetails.tableName" (change)="onChangeTable()" required>
                                                <option [value]="undefined" disabled hidden>Select Table Name</option>
                                                <option [value]="null" disabled hidden>Select Table Name</option>
                                                <option value="" disabled hidden>Select Table Name</option>
                                                <option *ngFor="let tName of tableList" value="{{tName}}">{{tName}}</option>
                                        </select>
                                        <span *ngIf="tablename.errors && tablename.touched" class='required'> Table Name required </span>
                                      </div>                                              
                                </div>
                                <div class="row" *ngIf="isTableEnable">
                                        <div class="col-md-12 p-0 form-group">
                                                <label class="label-control" for="increase">Mode<span class="star">*</span></label>
                                        <select [disabled]="!dbDetails.tableName" name="increase"  id="" class="form-control" (change)="onChangeMode($event.target.value)" #increase="ngModel" [(ngModel)]="dbDetails.mode" required>
                                                <option [value]="undefined" disabled hidden>Select Mode</option>
                                                <option [value]="null" disabled hidden>Select Mode</option>
                                                <option value="" disabled hidden>Select Mode</option>
                                                <option *ngFor="let each of modesList" [value]="each.value">{{each.name}}</option>
                                        </select> 
                                        <span *ngIf="increase.errors && increase.touched" 
                                        class='required'> Mode required </span>
                                        </div>                                        
                                </div>
                                <div class="row" *ngIf="isTableEnable">
                                        <div class="col-6 pl-0 form-group" *ngIf="isIncrement" >
                                                <label class="label-control" for="increment">Increment Column Name<span class="star">*</span></label>
                                                <input type="text" name="increment" class="form-control" #increment="ngModel" [(ngModel)]='dbDetails.increment' placeholder="Enter increment column name" required/>
                                                <span *ngIf="increment.errors && increment.touched" 
                                                     class='required'> Increment column name required </span>
                                        </div>
                                        <div class="col-6 pr-0 form-group" *ngIf="isTimestammp">
                                                <label class="label-control" for="timestamp">Timestamp Column Name<span class="star">*</span></label>
                                                <input type="text" name="timestamp" #timestamp="ngModel" class="form-control" [(ngModel)]='dbDetails.timestamp' placeholder="Enter Timestamp column name" required/>
                                                <span *ngIf="timestamp.errors && timestamp.touched" 
                                                     class='required'> Timestamp column name required </span>
                                        </div>
                                </div>
                        </div>                             
                </form>
                <div class="createform-footer">
                        <div class="row">
                          <div class="">
                             <div *ngIf="!isTableEnable">
                                <button class="btn bluebg-button mr-3" [disabled]="!dbDetails.hostName" (click)="getDBTables()">Fetch Tables</button>
                             </div>
                          </div>
                          <div class="">
                                <button class='btn bluebg-button' [disabled]='database.invalid' (click)="testDbConnection()">Test Connection</button>                                       
                                <button class='btn bluebg-button ml-3' [disabled]='isDisabled' (click)="slideUp()">Generate Process Graph</button>
                          </div> 
                        </div>                            
                </div>   
        </div>
<!-- </div> -->
</div>
</app-split-overlay>
</div>
<!-- </div> -->


<div  *ngIf="hiddenPopUp1">
<app-split-overlay  (closeOverlay)="closeOverlay($event)">
<process-category-overlay headerTitle= " Update Process" [overlay_data]="overlay_data" buttonName="Save & Generate" (proceed)="generateGraph($event)" class="bpmnCreate"></process-category-overlay>

</app-split-overlay>
</div>


<p-toast  [style]="{marginTop: '50px'}" ></p-toast>

<!-- limited access to this product -->
<p-confirmDialog #cd1 [style]="{width: '30vw'}" key="positionDialog1" position="center" [baseZIndex]="10000" 
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <p-footer>
      <button
        type="button"
        pButton
        label="Ok"
        value="Update"
        class="btn bluebg-button"
        (click)="cd1.accept()"
      ></button>     
    </p-footer>
</p-confirmDialog>

<!-- Data limit exceeded for user -->
<p-confirmDialog #cd2 [style]="{width: '30vw'}" key="positionDialog2" position="center" [baseZIndex]="10000" 
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <p-footer>
      <button
        type="button"
        pButton
        label="Ok"
        value="Update"
        class="btn bluebg-button"
        (click)="cd2.accept()"
      ></button>     
    </p-footer>
</p-confirmDialog>

<!-- This graph is under processing, please try again later -->
<p-confirmDialog #cd3 [style]="{width: '30vw'}" key="positionDialog3" position="center" [baseZIndex]="10000" 
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <p-footer>
      <button
        type="button"
        pButton
        label="Ok"
        value="Update"
        class="btn bluebg-button"
        (click)="cd3.accept()"
      ></button>     
    </p-footer>
</p-confirmDialog>

<!-- You can't delete inprogress process! -->
<p-confirmDialog #cd4 [style]="{width: '30vw'}" key="positionDialog4" position="center" [baseZIndex]="10000" 
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <p-footer>
      <button
        type="button"
        pButton
        label="Ok"
        value="Update"
        class="btn bluebg-button"
        (click)="cd4.accept()"
      ></button>     
    </p-footer>
</p-confirmDialog>

<!-- DeleteSelectedProcess -->
<p-confirmDialog #cd5 [style]="{width: '30vw'}" key="positionDialog5" position="center" [baseZIndex]="10000"
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <ng-template pTemplate="footer">
      <button type="button" pButton class="btn reset-btn" label="No" (click)="cd5.reject()"></button>
      <button type="button" pButton class="btn bluebg-button" label="Yes" (click)="cd5.accept()"></button>
   </ng-template>
</p-confirmDialog>

<!-- Please wait, Redirecting to process map -->
<p-confirmDialog #cd6 [style]="{width: '30vw'}" key="positionDialog6" position="center" [baseZIndex]="10000" 
 rejectButtonStyleClass="btn bluebg-button" [closable]="false">
   <p-footer>
      <button
        type="button"
        pButton
        label="Ok"
        value="Update"
        class="btn bluebg-button"
        (click)="cd6.accept()"
      ></button>     
    </p-footer>
</p-confirmDialog>
