<div class="grid-wrapper">
    <h2 class="grid-heading">AI Agents</h2>
    <div class="grid-container">
        <div *ngFor="let each of predefined_botsList" class="grid-item">
            <div class="content">
                <div class="top-section">
                    <div class="bot-image" (click)="onclickBot(each)">
                        <img src="../../../../assets/images/mini_bot.svg" alt="mini_bot">
                    </div>
                    <!-- <h3 class="bot-name">{{ each.predefinedBotName }} Agent</h3> -->

                    <span class="bot-name" (mouseenter)="each.isHovered = true" (mouseleave)="each.isHovered = false">
                        <h3 *ngIf="!each.isHovered" class="agent-name">{{ each.predefinedBotName }} Agent</h3>
                        <a *ngIf="each.isHovered" target="_blank" href="" [routerLink]="['/pages/aiagent/recruitment-ai-sales-page']" class="agent-name">{{ each.predefinedBotName }} Agent</a>
                    </span>
                    <p class="add-agents" (click)="showAddAgentDialog($event, each)">+ Add Agents</p>
                </div>
                <!-- <span class="expiry-date">Expires on: 01-08-2025 </span> -->
                <!-- <div class="bot-details-wrapper" [ngClass]="{'show-more': each.showMore}" #detailsWrapper>
                    <p class="bot-details">{{ each.details }}</p>
                </div> -->
                <div class="bot-details-wrapper" (click)="onclickBot(each)">
                    <p class="bot-details">{{ each.details }}</p>
                </div>


                <!-- <span *ngIf="each.details.length > 200" class="show-more-btn" (click)="toggleDetails($event,each, detailsWrapper)">
                    {{ each.showMore ? 'Show Less' : 'Show More' }}
                </span> -->
            </div>
        </div>
    </div>
    <div class="grid-container-skelton">
        <div *ngIf="predefined_botsList.length ===0" class="centered-message">
            <!-- <div *ngIf="!showSkeleton">
                <img src="../../../../assets/images/mini_bot.svg" alt="mini_bot">
                No Agent Found ... Please Subscribe to the Agents
            </div> -->

            <div *ngIf="true">
                <div class="p-grid p-formgrid skeleton-box">
                    <div class="p-field skeleton-card-box" *ngFor="let _ of [1, 2, 3, 4, 5, 6]">
                        <div class="custom-skeleton">
                            <div class="skeleton-header">
                                <p-skeleton shape="circle" size="4rem" styleClass="circle-skeleton"></p-skeleton>
                                <p-skeleton width="13rem" height="1rem"></p-skeleton>
                            </div>
                            <p-skeleton width="100%" height="50px" styleClass="info-skeleton"></p-skeleton>
                            <div class="skeleton-footer">
                                <p-skeleton width="4rem" height="2rem"></p-skeleton>
                                <p-skeleton width="4rem" height="2rem"></p-skeleton>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sticky-explore-section">
        <h2 class="search-heading">Explore More AI Agents</h2>
        <div class="search-container">
            <div class="search-bar-wrapper">
                <img src="../../../../assets/images/agent_search.svg" alt="mini_bot" class="search-icon">
                <input type="text" placeholder="Find Your Agent..." [disabled]="unfilteredAgentsList.length === 0"
                    [(ngModel)]="searchTerm" (input)="onSearch()" class="search-bar">
            </div>

            <div *ngIf="getTotalSelectedAgents() === 0" class="proceed-to-pay-placeholder"></div>
        </div>
        <div class="total-section" *ngIf="totalAmount > 0">
            <div class="d-inline-block mr-4 order-det" *ngIf="totalAmount >0" (mouseenter)="showPopup()"
                (mouseleave)="hidePopup()">Order details
                <div class="popup" [ngClass]="{'show': isPopupVisible}">
                    <div *ngFor="let plan of unsubscribed_agents" class="popup-plan-sec" style="text-align: left !important;">
                        <ng-container *ngIf="plan.quantity>=1">
                            <p>{{ plan.name }}: {{ plan.quantity }} ( {{plan.selectedTire}} )
                                <span *ngFor="let price of plan.priceCollection">
                                    <span *ngIf="price.tiersMode === 'year' && plan.selectedTire === 'Yearly'">
                                        <span class="amount">$ {{ price.unitAmount * plan.quantity }}.00</span>
                                    </span>
                                    <span *ngIf="price.tiersMode === 'month' && plan.selectedTire === 'Monthly'">
                                        <span class="amount">$ {{ price.unitAmount * plan.quantity }}.00</span>
                                    </span>
                                </span>
                            </p>
                        </ng-container>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <span class="popup-plan-sec b"><b>Total</b> </span>
                        <span class="total-amount amount b"><b>$ {{ totalAmount }}.00</b></span>

                    </div>
                </div>
            </div>
            <button class="proceed-to-pay" (click)="proceedToPay()">
                Proceed to Pay
            </button>
        </div>
        <div class="scrollable-explore-content">
            <div class="inner-cards-container">
                <div class="card" *ngFor="let plan of unsubscribed_agents; let i = index"
                    (click)="!((selectedPlan === 'Monthly' && plan.isMonthlySubscribed) || (selectedPlan === 'Yearly' && plan.isYearlySubscribed))">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 10px;">
                            <div class="d-flex align-items-center">
                                <div class="bot-image">
                                    <img src="../../../../assets/images/agent/bot-image-svg.svg" alt="Agent Image"
                                        height="30px" width="30px">
                                </div>
                                <div class="agent-names" style="margin-left: 10px;">
                                    <!-- <span class="card-title-new">{{plan.name}}</span> -->
                                    <span class="card-title-new" (mouseenter)="plan.isHovered = true" (mouseleave)="plan.isHovered = false">
                                        <span *ngIf="!plan.isHovered" class="agent-name">{{plan.name}}</span>
                                        <a *ngIf="plan.isHovered" target="_blank" href="" [routerLink]="['/pages/aiagent/recruitment-ai-sales-page']" class="agent-name">{{plan.name}}</a>
                                    </span>
                                </div>
                            </div>
                            <div class="view-more d-flex align-items-center">
                                <ng-container *ngFor="let detail of plan.priceCollection">
                                    <div *ngIf="detail.tiersMode === 'year' && selectedPlan === 'Yearly'"
                                        class="price-item-block">
                                        <div class="box-outer">
                                            <span class="text-design" *ngIf="plan.quantity <=0">Select no of
                                                Agents</span>
                                            <div class="square-controls" *ngIf="!detail.isPlanSubscribed"
                                                (click)="$event.stopPropagation()">
                                                <div class="square-btn-left decrease"
                                                    (click)="decrementQuantity(plan,i)">-</div>
                                                <span class="square-quantity">{{plan.quantity}}</span>
                                                <div class="square-btn-right increase"
                                                    (click)="incrementQuantity(plan,i)">+</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div *ngIf="detail.tiersMode === 'month' && selectedPlan === 'Monthly'"
                                        class="price-item-block">
                                        <div class="box-outer">
                                            <span class="text-design" *ngIf="plan.quantity <=0">Select no of
                                                Agents</span>
                                            <div class="square-controls" *ngIf="!detail.isPlanSubscribed"
                                                (click)="$event.stopPropagation()">
                                                <div class="square-btn-left decrease"
                                                    (click)="decrementQuantity(plan, i)">-</div>
                                                <span class="square-quantity">{{plan.quantity}}</span>
                                                <div class="square-btn-right increase"
                                                    (click)="incrementQuantity(plan,i)">+</div>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center price-section"
                            *ngFor="let detail of plan.priceCollection">

                            <!-- Showing Plan Amount -->
                            <div *ngIf="detail.tiersMode === 'month' && plan.selectedTire === 'Monthly' ">
                                <div class="price-container">
                                    <div class="price-label">
                                        <b><span class="price skyblue">$ {{detail.unitAmount}}</span> /
                                        </b>{{detail.tiersMode}} <span> (Single Agent)</span>
                                    </div>
                                    <div class="price-amt-gr price-selection price-amount"
                                        *ngIf="detail.unitAmount * plan.quantity > 0">
                                        $ {{ detail.unitAmount * plan.quantity | number:'1.2-2' }}
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="detail.tiersMode === 'year' && plan.selectedTire === 'Yearly' ">
                                <div class="price-container">
                                    <div class="price-label">
                                        <b><span class="price skyblue">$ {{detail.unitAmount}}</span> /
                                        </b>{{detail.tiersMode}} <span> (Single Agent)</span>
                                    </div>
                                    <div class="price-amt-gr price-selection price-amount"
                                        *ngIf="detail.unitAmount * plan.quantity > 0">
                                        $ {{ detail.unitAmount * plan.quantity | number:'1.2-2' }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Agent Features -->
                        <div class="frame">
                            <!-- <p class="text-design-below">{{formatFeatures(plan.features)}}</p> -->
                            <p class="text-design-below">{{plan.description}}</p>
                        </div>

                        <!-- Agent plan toggle monthly or yearly -->
                        <div class="plan-selector">
                            <label>
                                <input type="radio" name="plan-{{plan.name}}" value="monthly"
                                    (change)="changePlan('monthly',plan)" [checked]="selectedPlan === 'Monthly'">
                                <span class="custom-radio"></span>
                                Monthly
                            </label>
                            <label>
                                <input type="radio" name="plan-{{plan.name}}" value="yearly"
                                    (change)="changePlan('yearly',plan)" [checked]="selectedPlan === 'Yearly'">
                                <span class="custom-radio"></span>
                                Yearly
                            </label>
                        </div>

                    </div>
                </div>
            </div>

            <div *ngIf="unsubscribed_agents.length == 0" class="centered-message">
                <img src="../../../../assets/images/mini_bot.svg" alt="mini_bot">
                No Agent Found
            </div>
            <div *ngIf="unfilteredAgentsList.length === 0" class="centered-message">
                <div>
                    <img src="../../../../assets/images/mini_bot.svg" alt="mini_bot">
                    We are working on more AI Agents ...
                </div>
            </div>
            <!-- </div> -->
        </div>
    </div>

    <div class="custom-modal" *ngIf="displayModal">
        <div class="custom-modal-content">
            <div class="top-section-model">
                <div class="model-img">
                    <img src="../../../../assets/images/mini_bot.svg" alt="mini_bot">
                </div>
                <h3 class="bot-name-model">{{ selectedBot?.predefinedBotName }}</h3>
            </div>
            <div class="model-details-wrapper">
                <p class="bot-details">{{ selectedBot?.details }}</p>
            </div>
            <div class="dialog-footer">
                <button class="show-less-btn" (click)="closeModal()">Show Less</button>
                <button class="create-agent-btn" (click)="createBot()">Create Agent</button>
            </div>
        </div>
    </div>

    <p-dialog [(visible)]="displayAddAgentDialog" [draggable]="true" [style]="{width: '40vw', height:'27vw'}"
        [modal]="true" [showHeader]="false" [closable]="true" styleClass="custom-dialog">
        <app-ai-agent-add-agents-dialog [selectedAgent]="selectedAgent"
            (close)="closeDialog()"></app-ai-agent-add-agents-dialog>
    </p-dialog>