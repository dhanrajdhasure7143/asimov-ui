<div class="new-prj-details">
  <mat-card id="projects_details_screen" *ngIf="projects_toggle==false">
    <div class="projects-header maincreat">
      <span class="projects-back-button" routerLink="/pages/projects/listOfProjects">
        <i aria-hidden="true" class="fas fa-arrow-left"></i>
      </span>
      <span class="projects-header-title">
        Project Details 
      </span>
      <span class="pull-right">
        <span  (click)="navigateToProjectRepo()">
          <button class="btn btn-primary prj-lst-btn">
            <img src="../../../../assets/images/Projects/Project-Repo.svg" class="testplus default-img">
            <img src="../../../../assets/images/Projects/project-repo-white.svg" class="testplus hover-img">
             Project Repo
          </button>
        </span>
        <span >
          <button class="btn btn-primary prj-crt-btn">
            <img class="testplus" src="../../../../assets/images/BPMS/Edit-white.svg"> Edit
          </button>
        </span>
        
        <!-- <span class="projects-menu-item"><i class="ri-history-line"></i></span>
        <span class="projects-menu-item"><i class="ri-more-2-line"></i></span> -->
      </span>
    </div>
  
    <div class="projects-table-body">
        <app-project-details-header [users_list]="users_list" [processes]="processes"></app-project-details-header>
    </div>    
  </mat-card>  
  
  <mat-card class="new-prj-tasklist" id="projects_details_screen" *ngIf="projects_toggle==false">
    <div class="row">
      <div class="col-md-4 p-0">
        <span class="projects-header-title">
          Tasks
        </span>
      </div>
      <div class="col-md-8 pr-0">
        <span class="pull-right">
          <!--<span class="projects-menu-item">
             <button type="button" class="btn btn-default new-attach-btn">Attachments</button> 
          </span>-->
          <span class="">
              <button type="button" class="btn btn-primary" (click)="createtask(createtaskmodal)">
                <img src="../../../../assets/images/Projects/White-plus.svg" class="testplus" />Create New
              </button>
          </span>
        </span>
      </div>
    </div>
    
    <div class="tasks-body">
      <!-- <img src="..\assets\images\Projects\no_items.svg" height="190px" >
      <figcaption>No items to display!</figcaption> -->
      <table mat-table #sort10="matSort" [dataSource]="dataSource2" matSort class="projecttable table" id="autotable">

        <ng-container matColumnDef="taskCategory">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Category</th>
          <td mat-cell   *matCellDef="let element">
            <span *ngIf="element.taskCategory!=null" [matTooltip]="element.taskCategory">{{element.taskCategory}}</span>
            <span *ngIf="element.taskCategory==null">---</span>
          </td>

      </ng-container>

      <ng-container matColumnDef="taskName">
        <th mat-header-cell *matHeaderCellDef>Task Name</th>
        <td mat-cell *matCellDef="let element">
          <span *ngIf="element.taskName!=null" [matTooltip]="element.taskName">{{element.taskName}}</span>
            <span *ngIf="element.taskName==null">---</span>
        </td>
    </ng-container>
      <ng-container matColumnDef="resources">
          <th mat-header-cell *matHeaderCellDef>Resource </th>
          <td mat-cell *matCellDef="let element">
              <span *ngIf="element.resources!=null">{{element.resources| userPipe : users_list}}</span>
              <span *ngIf="element.resources==null">---</span>
              <!-- <div class="addresource-btn">
                <span mat-mini-fab color="primary" matTooltip="Add Resources" (click)="addresource(addresourcemodal)"><i class="fa fa-plus"></i></span>
            </div> -->
          </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status  </th>
        <td mat-cell *matCellDef="let element">
          <span *ngIf="element.status!=null">{{element.status}}</span>
          <span *ngIf="element.status==null">---</span>
        </td>
    </ng-container>
     
      <ng-container matColumnDef="percentage">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Percentage Complete</th>
        <td mat-cell *matCellDef="let element" >
          <span class="tab-text labelcont" >{{element.percentageComplete}}%
            <mat-progress-bar mode="determinate" [(value)]="element.percentageComplete"></mat-progress-bar>
        </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="lastModifiedTimestamp">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Updated</th>
        <td mat-cell *matCellDef="let element" >
          <span *ngIf="element.lastModifiedTimestamp!=null">{{element.lastModifiedTimestamp | date}} {{element.lastModifiedTimestamp.split("T")[1].split(".")[0]}}</span>
          <span *ngIf="element.lastModifiedTimestamp==null">---</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="lastModifiedBy">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Updated By</th>
        <td mat-cell *matCellDef="let element" >
          <span *ngIf="element.lastModifiedBy!=null">{{element.lastModifiedBy}}</span>
          <span *ngIf="element.lastModifiedBy==null">---</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="createdBy">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created By</th>
        <td mat-cell *matCellDef="let element" >
          <span *ngIf="element.createdBy!=null">{{element.createdBy}}</span>
          <span *ngIf="element.createdBy==null">---</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef> Actions</th>
        <td mat-cell *matCellDef="let element" class="action-link tablacs"> 
          <div class="newinntalx">
            <a  (click)="updatetaskdata(updatetaskmodal,element)" matTooltip="Edit Task">
              <img src="../../../../assets/images/Projects/edit.svg">
            </a> |
            <a (click)="deletetask(element)" matTooltip="Delete Task" >
              <img src="../../../../assets/images/Projects/delete-red.svg">
            </a> |
            <a class="clickable text-dark"  *ngIf="element.taskCategory =='RPA Implementation'|| element.taskCategory =='BPMN Design'"
            (click)="navigateToWorkspace(element)" matTooltip="Model">
              <img src="../../../../../assets/images/Projects/eye-show.svg" />
            </a> 

            <a class="disable-bg text-dark" *ngIf="element.taskCategory =='Analysis'|| element.taskCategory =='Task Mining'" >
              <img src="../../../../../assets/images/Projects/eye-hide.svg" />
            </a>
        </div>
        </td>
      </ng-container>

        <ng-container matColumnDef="Loading">
          <td mat-footer-cell class="mat-footer" style="text-align:center" *matFooterCellDef colspan="9">
              Loading
          </td>
      </ng-container>
        <ng-container matColumnDef="noData">
            <td mat-footer-cell class="mat-footer" style="text-align:center" *matFooterCellDef colspan="9">
                No Records Found
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr class="row-highlight" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr class="row-highlight mat-footer" mat-footer-row *matFooterRowDef="['Loading']" [ngClass]="{'hide':dataSource2!=null}"></tr>
        <tr class="row-highlight mat-footer" mat-footer-row *matFooterRowDef="['noData']" [ngClass]="{'hide':!(dataSource2!=null && dataSource2.data.length==0)}"></tr>
      </table>
      </div>
      <mat-paginator class="newpaginationdiv" #paginator101 [pageSize]="5" [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true">
      </mat-paginator>
    
  </mat-card>


  <div class="row bortopsec">
    <div class="col-md-6 pl-0 resources">
      <mat-card id="projects_details_screen" class="new-resourcediv" *ngIf="projects_toggle==false">
        <div class="row">
          <div class="col-md-6 p-0">
            <span class="projects-header-title">
              Resources
            </span>
          </div>
          <div class="col-md-6 pr-0">
            <span class="pull-right">
                <button type="button" class="btn btn-add"(click)="addresource(addresourcemodal)">
                  <img src="../../../../assets/images/Projects/White-plus.svg" class="testplus"/>Add New
                </button>
            </span>
          </div>
        </div>
        <!-- <div class="">
          <span class="">
           
          </span>
          
          <span class="projects-header-title">
            Resources
          </span>
          <span class="pull-right" style="font-size:20px;">
            <span class="projects-menu-item" ></span>
            <span class="projects-menu-item"><button type="button" class="btn btn-primary">Create New</button></span>
          </span>
        </div> -->
        
        <div class="projects-table-body profile-table">
          <table class="table">
            <thead>
              <tr class="separated">
                <th></th>
                <th>Name</th>
                <th>Role</th>
                <th>Email</th>
                <th>Last Updated</th>
              </tr>
            </thead>
            <tbody *ngIf="users_list.lenght!=0">
              <tr *ngFor="let user of (projectDetails.resources | userDetials : users_list)  | paginate: { itemsPerPage: 3, currentPage: p } ">
                <td>
                  <span *ngIf="user.userId.profilePic!=null"><img src="../../../../assets/images/BPMS/user1.png" /></span>
                  <span  class="letter-image" *ngIf="user.userId.profilePic==null">
                    <span class="letter">{{user.userId.firstName | slice:0:1}}{{user.userId.lastName | slice:0:1}}</span>
                  </span>
                </td>
                <td >{{user.userId.firstName+" "+ user.userId.lastName}}</td>
                <td >{{user.roleID.displayName}}</td>
                <td >{{user.userId.userId}}</td>
                <td >{{user.userId.created_at | date}}</td>
              </tr>

            </tbody>
            
          </table>

          <pagination-controls class="pull-right" (pageChange)="p = $event"></pagination-controls>
        </div>
        
      </mat-card>
    </div>
    <div class="col-md-6 p-0 documents">
      <mat-card id="projects_details_screen" class="new-docdiv" *ngIf="projects_toggle==false">
        <div class="row">
          <div class="col-md-6 p-0">
            <span class="projects-header-title">
              Recently Added Documents
            </span>
          </div>
          <div class="col-md-6 pr-0">
            <span class="pull-right">
                <button type="button" class="btn btn-primary">
                  <img src="../../../../assets/images/BPMS/upload.svg" class="testplusupload">Upload New</button>
            </span>
          </div>
        </div>
        <!-- <div class="">
          <span class="">
           
          </span>
          
          <span class="projects-header-title">
            Recently Added Documents
          </span>
          <span class="pull-right" style="font-size:20px;">
            <span class="projects-menu-item"  ></span>
            <span class="projects-menu-item"><button type="button" class="btn btn-primary">Upload</button></span>
          </span>
        </div> -->
        
        <div class="projects-table-body">
          <table class="table">
            <thead>
              <tr class="separated">
                <th>Document Name</th>
                <th>Uploaded By</th>
                <th>Uploaded Date</th>
                <th>File Size</th>
              </tr>
            </thead>
            <tbody>
              <tr >
                <td>Task Mining Doc</td>
                <td>Lakshmi Kadali</td>
                <td>Jul 1st,2021</td>
                <td>150kb</td>
              </tr>
              <tr >
                <td>Design Doc</td>
                <td>Karthik Peddinti</td>
                <td>Jul 10th,2021</td>
                <td>125MB</td>
              </tr>
              <tr >
                <td>Approval Email</td>
                <td>Siva Simhadri</td>
                <td>Jul 21st,2021</td>
                <td>10MB</td>
              </tr>
            </tbody>              
          </table>
        </div>
        
      </mat-card>
    </div>   
  </div>



</div>



<ng-template class="modal-lg" #createtaskmodal>
  <app-create-tasks [createtaskmodalref]="createtaskmodalref" [project_id]="project_id"></app-create-tasks>
</ng-template>


<ng-template  #addresourcemodal>
  <div>
    <app-add-resources (newItemEvent)="addresources($event)" [addresourcemodalref]="addresourcemodalref"></app-add-resources>
  </div>
  
</ng-template>

<ng-template class="modal-lg" #updatetaskmodal>
  <div class="modal-header modelprhead">
    <h3><b> {{selectedtaskdata.id}} / {{selectedtaskdata.taskCategory}} / {{selectedtaskdata.taskName}}</b></h3>
    <p>Last Updated Date : {{selectedtaskdata.lastModifiedTimestamp | date}}</p>
     <!-- <button type="button" class="close pull-right" aria-label="Close" (click)="updatetaskmodalref.hide()">
      <span aria-hidden="true"><img alt="" src="../../../../../assets/images/Projects/circle-close.svg"></span>
    </button>  -->
  </div>
  <div class="modal-body" style="width:100%;overflow-x: auto;height:calc( 68vh - 10px)">
      <div class="container p-0" style="width:100%">
              <form [formGroup]="updatetaskForm"  (ngSubmit)="updatetask()">
              
                  <div class="row">
                      <div class="col-md-12">
                        <div class="form-fileds col-md-3 pl-0">
                          <label id="assignee" for="assignee">Assignee</label>
                          <p>{{selectedtaskdata.resources| userPipe : users_list}}</p>
                        </div>  
                        <div class="form-fileds col-md-3 pr-0">
                          <label id="startdate" for="startDate">Start Date</label>
                          <p>{{selectedtaskdata.startDate | date}}</p>
                        </div>
                        <div class="form-fileds col-md-3 pr-0">
                          <label id="enddate" for="endDate">End Date</label>
                          <p>{{selectedtaskdata.endDate | date}}</p>
                        </div>
                        <div class="form-fileds col-md-3 pr-0">
                          <label id="percentage" for="percentage">Percentage Completed</label>
                        <ng5-slider [(value)]="slider" formControlName="percentageComplete" [options]="options" ></ng5-slider>
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="form-fileds col-md-6 pl-0">                         
                          <label id="status" for="status">Status<span style="color:red">*</span></label>
                          <select   formControlName="status"  class="form-control data">
                            <option value="">Select Status</option>
                            <option value="New">New</option>
                            <option value="In Progress">In Progress</option>
                            <option value="In Review">In Review</option>
                            <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                        <span *ngIf="updatetaskForm.get('status').invalid && updatetaskForm.get('status').touched" style="color:red" class="fa fa-info-circle errspan">Status Required*</span>
                        </div>
                        <div class="form-fileds col-md-6 pr-0">
                          <label id="priority" for="priority">Priority <span style="color:red">*</span></label>
                          <select formControlName="priority" class="form-control data">
                              <option value="">Select Priority</option>
                              <option value="High">High</option>
                              <option value="Medium">Medium</option>
                              <option value="Low">Low</option>
                          </select>
                          <span
                              *ngIf="updatetaskForm.get('priority').invalid && updatetaskForm.get('priority').touched"
                              style="color:red" class="fa fa-info-circle errspan">Priority Required*</span>
                        </div>
                       
                      </div>
                      <br> <br>
                      <div class="col-md-12">
                        <label id="summary" class="label-control" >Summary</label>
                        <textarea class="form-control" formControlName="summary"  style="height:40px;" placeholder="Enter Summary">
                        </textarea>
                        <br>
                      </div>
                     
                      <div class="col-md-12">
                        <label id="description" class="label-control" >Description</label>
                                                    <textarea class="form-control" formControlName="description" style="height:70px;" placeholder="Enter Description">
                                                    </textarea>
                      </div>
                      <div class="col-md-12">
                        <label class="label-control" ><h4><b>Activity</b></h4></label>
                      </div>
                      <div class="col-md-12">
                        <mat-tab-group [selectedIndex]="selectedTab" id="Project-dashboard-tabs" (selectedTabChange)="onTabChanged($event)">
                          <mat-tab label="Comment">
                            <br>
                            <div class="t-comments-box">
                              <div class="add-comment">
                                <div  class="res-circle " *ngIf="profilePicture==false">{{firstletter|uppercase}}</div> 
                                <div   *ngIf="profilePicture==true"><img class="res-circle " [src]="retrievedImage" ></div>
                                <div>
                                  &nbsp;
                                </div>
                                <div class="comment-input">
                                  <input
                                    class=" form-control-sm" 
                                    type="text" #commentInput id="addcomment" 
                                    placeholder="Add a comment.."
                                  />
                                  <div class="comment-send"><i class="fab fa-telegram-plane" id="sendcomment" (click)="postcomments(commentInput.value)"></i></div>
                                </div>
                              </div>
                              <div class="comment comment-level-1" *ngIf="taskcomments!=0">
                                <!-- <div  class="res-circle " *ngIf="profilePicture==false">{{firstletter|uppercase}}</div> 
                                <div   *ngIf="profilePicture==true"><img class="res-circle " [src]="retrievedImage" ></div> -->
                                &nbsp;
                                <div>
                                <div class="comment-content" *ngFor="let c of taskcomments;let i=index"> 
                                  <div> 
                                    <div class="userimage" *ngIf="(c.createdUserEmail|userImagePipe: users_list)as result">
                                      <div  class="res-circle " *ngIf="result.length==3">{{c.createdUserEmail|userImagePipe: users_list}}</div> 
                                      <div  *ngIf="result.length>3"><img class="res-circle " src="{{c.createdUserEmail|userImagePipe: users_list}}" ></div>
                                    </div>
                                  </div>
                                  <div class="comment-name">
                                    {{c.createdBy}} &nbsp; {{c.createdTimestamp | date}}
                                  </div>
                                  <div class="commentsadded" *ngIf="i!=commentnumber">
                                 <b>{{c.comments}}</b> 
                                </div>
                                <div class="updatecomments" *ngIf="(showeditcomment && i==commentnumber)">
                                 <input type="text" name="comment" formControlName="editcomment" placeholder="Add Comment..."/>
                                 
                                 <div class="row">
                                  <div class="col-md-3" id="updatesavecomment">
                                    <br>
                                   <button type="button" class="btn btn-primary"  (click)="updatecomment(c.id)">Save</button>
                                   </div>
                                   <div class="col-md-3" id="updatecancelcomment">
                                   <button type="button" class="btn btn-primary" (click)="posteditcancelcomment()">Cancel</button>
                                  </div>
                                <!-- <div class="col-md-6" >
                                  <button type="button" class="btn btn-primary" (click)="posteditcancelcomment()">Cancel</button>
                                </div> -->
                              </div>
                                </div>
                                 <div class="comment-action" *ngIf="i!=commentnumber">
                                  <button type="button" (click)="editComments(c.comments,i)" matTooltip="Edit Comment" style="color:red;cursor:pointer" >
                                   Edit
                                 </button> 
                                
                               </div>
                                </div>
                                </div>
                              </div>
                            
                            </div>
                            
                          </mat-tab>  
                          <mat-tab label="History">
                            <br>
                            <ul>
                              <li *ngFor="let history of taskhistory">
                                {{history.message}}
                                <hr>
                              </li>
                            </ul>
                            <!-- <div class="comment-content" > 
                             
                              </div> -->
                          </mat-tab>
                          <mat-tab label="Attachments">
                            <br>
                            <div class="comment comment-level-1">
                              <!-- <div  class="res-circle " *ngIf="profilePicture==false">{{firstletter|uppercase}}</div> 
                              <div   *ngIf="profilePicture==true"><img class="res-circle " [src]="retrievedImage" ></div> -->
                              &nbsp;
                              <div>
                                <div class="comment-label">
                                 
                                  <!-- <span class="comment-time"> - 5 days ago</span> -->
                                </div>
                                <div class="comment-content" *ngFor="let attachments of taskattacments"> 
                                  <div class="attachment-name">
                                    <!-- {{firstname}} &nbsp;{{lastname}}&nbsp; {{currentdate | date}} -->
                                  </div>
                                  <div>
                                    File Name : <b>{{attachments.fileName}}</b>
                                </div>
                                <div class="attachment-action">
                                  File Size :<b>{{attachments.fileSize | fileSizePipe}}</b>
                                
                               </div>
                                </div>

                               
                              </div>
                            </div>
                            
                          </mat-tab>
                          <mat-tab label="Resources">
                            <div class="projects-table-body">
                              <table class="table">
                                <thead>
                                  <tr class="separated">
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Last Updated</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td >{{selectedtaskdata.resources| userPipe : users_list}}</td>
                                    <!-- <td style="text-align:center">{{roles?roles:'-'}}</td> -->
                                    <td >{{roles?roles:'-'}}</td>
                                    <td >{{selectedtaskdata.lastModifiedTimestamp | date}}</td>
                                  </tr>
                                </tbody>
                                
                              </table>
                            </div>
                          </mat-tab>
                        </mat-tab-group>
                      </div>  
                  </div>
              </form>
      </div>
  </div>          
  <div class="modal-footer modelprfooter">
    <div class="pull-right">
      <button (click)="resetupdatetaskproject()" class="btn btn-primary">Reset</button>
      <button (click)="canceltaskform()" class="btn btn-primary">Cancel</button>
      <button [disabled]="updatetaskForm.invalid" (click)="updatetask()" class="btn btn-primary btn-update">Update</button>
    </div>
  </div>
</ng-template>
